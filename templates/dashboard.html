{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
  <div class="col">
    <h1 class="display-4">üíÖ Salon Pulse Dashboard</h1>
    <p class="lead">Your business intelligence at a glance</p>
  </div>
</div>

<!-- Technician Performance Section -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">üë©‚Äçüíº Technician Performance</h5>
      </div>
      <div class="card-body">
        {% if performance %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Technician</th>
                <th>Total Jobs</th>
                <th>Total Revenue</th>
                <th>Total Tips</th>
                <th>Combined Earnings</th>
              </tr>
            </thead>
            <tbody>
              {% for tech in performance %}
              <tr>
                <td><strong>{{ tech.name }}</strong></td>
                <td>{{ tech.total_jobs }}</td>
                <td>${{ "%.2f"|format(tech.total_revenue or 0) }}</td>
                <td>${{ "%.2f"|format(tech.total_tips or 0) }}</td>
                <td class="text-success">
                  <strong>${{ "%.2f"|format((tech.total_revenue or 0) + (tech.total_tips or 0)) }}</strong>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">No appointment data yet. Start by adding your first appointment!</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Customer Retention Alerts -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">‚ö†Ô∏è Customer Retention Alerts</h5>
      </div>
      <div class="card-body">
        {% if at_risk %}
        <p class="mb-3">These customers haven't visited in over 30 days:</p>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Customer Name</th>
                <th>Phone</th>
                <th>Days Since Last Visit</th>
              </tr>
            </thead>
            <tbody>
              {% for customer in at_risk %}
              <tr>
                <td>{{ customer.name }}</td>
                <td>{{ customer.phone }}</td>
                <td class="text-danger">{{ customer.days_missed }} days</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-success mb-0">‚úÖ Great job! All customers are engaged.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row">
  <div class="col-md-6 mb-3">
    <div class="card shadow-sm h-100">
      <div class="card-body text-center">
        <h5 class="card-title">üìä View Analytics</h5>
        <p class="card-text">See detailed appointment history and charts</p>
        <a href="/appointments" class="btn btn-primary">View Appointments</a>
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-3">
    <div class="card shadow-sm h-100">
      <div class="card-body text-center">
        <h5 class="card-title">üë• Customer Analytics</h5>
        <p class="card-text">Analyze customer lifetime value and segments</p>
        <a href="/customers" class="btn btn-success">View Customers</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
